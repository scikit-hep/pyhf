|release v0.7.0|_
=================

This is a minor release from ``v0.6.3`` â†’ ``v0.7.0``.

Important Notes
---------------

* All backends are now fully compatible and tested with
  `Python 3.10 <https://peps.python.org/pep-0310/>`_.
  (PR :pr:`1809`)
* A ``pyhf.default_backend`` has been added that is configurable through a
  ``default`` kwarg in :func:`pyhf.set_backend`.
  (PR :pr:`1646`)
* Performance in :class:`pyhf.readxml` is increased by improvements to
  :func:`pyhf.readxml.import_root_histogram`.
  (PR :pr:`1691`)
* :func:`pyhf.contrib.utils.download` is now more robust to different target file types.
  (PRs :pr:`1697`, :pr:`1704`)
* The minimum required dependencies have been updated to support added features:

   - ``scipy>=1.2.0``
   - ``click>=8.0.0``
   - ``jsonschema>=4.15.0``
   - ``importlib_resources>=1.4.0`` (for Python 3.7, 3.8)
   - ``typing_extensions>=3.7.4.3`` (for Python 3.7 only)

* The minimum required backend versions have been updated to support added features:

   - JAX backend requires ``jax>=0.2.10``, ``jaxlib>=0.1.61``
   - PyTorch backend requires ``torch>=1.10.0``
   - TensorFlow backend requires ``tensorflow>=2.7.0``, ``tensorflow-probability>=0.11.0``
   - iminuit optimizer requires ``iminuit>=2.7.0``
   - xmlio extra requires ``uproot>=4.1.1``

Fixes
-----

* Use improvements to ``jsonschema.RefResolver`` to avoid ``jsonschema.exceptions.RefResolutionError``.
  (PR :pr:`1976`)

Features
--------

Python API
~~~~~~~~~~

* Supported options for :func:`pyhf.infer.hypotest` can now be passed as kwargs
  through the :func:`pyhf.infer.intervals.upper_limits.upper_limit` API.
  (PR :pr:`1613`)
  This now enables things like using :class:`pyhf.infer.calculators.ToyCalculator`
  as the calculator used for the hypothesis test scan:

  .. code:: pycon

      >>> import numpy as np
      >>> import pyhf
      >>> pyhf.set_backend("jax")
      >>> model = pyhf.simplemodels.uncorrelated_background(
      ...     signal=[12.0, 11.0], bkg=[50.0, 52.0], bkg_uncertainty=[3.0, 7.0]
      ... )
      >>> observations = [51, 48]
      >>> data = pyhf.tensorlib.astensor(observations + model.config.auxdata)
      >>> scan = np.linspace(0, 5, 21)
      >>> obs_limit, exp_limits, (scan, results) = pyhf.infer.intervals.upper_limits.upper_limit(
      ...     data, model, scan, return_results=True, calctype="toybased", ntoys=3000
      ... )

* A ``pyhf.default_backend`` has been added that is configurable through a
  ``default`` kwarg in :func:`pyhf.set_backend`.
  (PR :pr:`1646`)
  This allows setting setting the ``pyhf.default_backend`` to be different from the value of
  ``pyhf.tensorlib`` returned by :func:`pyhf.get_backend`, which can be useful in situations where
  a model construction is needed.

  .. code:: pycon

      >>> import jax
      >>> import pyhf
      >>> pyhf.set_backend("jax", default=True)
      >>> pyhf.set_backend("numpy")
      >>> pyhf.get_backend()
      (<pyhf.tensor.numpy_backend.numpy_backend object at 0x...>, <pyhf.optimize.scipy_optimizer object at 0x...>)
      >>> pyhf.default_backend
      <pyhf.tensor.jax_backend.jax_backend object at 0x...>
      >>> def example_op(x):
      ...     return 2 * pyhf.default_backend.power(pyhf.default_backend.astensor(x), 3)
      ...
      >>> example_op([2.0])
      DeviceArray([16.], dtype=float64)
      >>> jax.jacrev(jax.jit(example_op))([2.0])
      [DeviceArray([24.], dtype=float64, weak_type=True)]

Deprecations
------------

Python API
~~~~~~~~~~

* The :func:`pyhf.infer.intervals.upperlimit` API has been deprecated in favor of
  :func:`pyhf.infer.intervals.upper_limits.upper_limit`.
  The :func:`pyhf.infer.intervals.upperlimit` API will removed in ``pyhf`` ``v0.9.0``.
  (PR :pr:`1274`)

Removals
--------

Python API
~~~~~~~~~~

* The :func:`pyhf.simplemodels.hepdata_like` API, deprecated since ``pyhf``
  ``v0.6.2``, has been removed.
  (PR :pr:`1670`)

Contributors
------------

``v0.7.0`` benefited from contributions from:

* Alexander Held
* Mason Proffitt
* Lars Henkelmann
* Aryan Roy
* Graeme Watt
* Jerry Ling
* Nathan Simpson
* Beojan Stanislaus

.. |release v0.7.0| replace:: ``v0.7.0``
.. _`release v0.7.0`: https://github.com/scikit-hep/pyhf/releases/tag/v0.7.0
